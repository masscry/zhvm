################################################################################
#                 FIBBONACHI NUMBERS SEQUENCE                                  #
################################################################################

$d = add[,1024]
$p = add[,@main]

!fib
$d = svl[$a] $d = sub[$d, 4]
$d = svl[$0] $d = sub[$d, 4]
$d = svl[$1] $d = sub[$d, 4]
$d = svl[$2] $d = sub[$d, 4]

$0 = eq[$a, 0]
$p = cmn[$0, @fbcase0]
$0 = eq[$a, 1]
$p = cmn[$0, @fbcase1]
$p = add[,@fbcaset]

!fbcase0
$b = add[,0]
$p = add[,@fibend]

!fbcase1
$b = add[,1]
$p = add[,@fibend]

!fbcaset
$1 = sub[$a,1]
$2 = sub[$a,2]

$a = add[$1]
$d = svl[$p, 12] $d = sub[$d, 4] $p = add[,@fib]
$1 = add[$b]

$a = add[$2]
$d = svl[$p, 12] $d = sub[$d, 4] $p = add[,@fib]
$2 = add[$b]

$b = add[$1, $2]
$p = add[,@fibend]

!fibend
$d = add[$d, 4] $2 = ldl[$d]
$d = add[$d, 4] $1 = ldl[$d]
$d = add[$d, 4] $0 = ldl[$d]
$d = add[$d, 4] $a = ldl[$d]
$d = add[$d, 4] $p = ldl[$d]

!main

$a = add[,15]
$d = svl[$p, 12] $d = sub[$d, 4] $p = add[,@fib]

$a = add[$b]
cll[,0]

hlt[]